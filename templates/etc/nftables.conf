#!/usr/sbin/nft -f

flush ruleset

table inet filter {
	chain input {
		type filter hook input priority filter; policy drop;
		iifname "enp4s0" goto internet
		iifname "eth0" accept
		iifname "lo" accept
		iifname "wlan0" accept
	}

	chain forward {
		type filter hook forward priority filter; policy accept;
	}

	chain output {
		type filter hook output priority filter; policy accept;
	}

	chain internet {
		tcp dport {{ sshd_port_extra }} accept
		udp dport 51820 accept
		ct state established,related accept
		ip protocol icmp accept
		drop
	}
}
table ip nat {
	chain prerouting {
		type nat hook prerouting priority dstnat; policy accept;
		iifname "enp4s0" tcp dport { {{ server_ports_forwarded_tcp }} } dnat to {{ local_net_prefix }}.1
	}

	chain postrouting {
		type nat hook postrouting priority srcnat; policy accept;
		oifname "enp4s0" masquerade
	}
}
